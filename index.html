<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Офицеры и части</title>
    <style>
        table {
            border-collapse: collapse;
            width: 100%;
        }
        th, td {
            border: 1px solid #dddddd;
            text-align: left;
            padding: 8px;
        }
        th {
            background-color: #f2f2f2;
        }
        form {
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <h1>Офицеры и части</h1>

    <h2>Офицеры</h2>
    <form id="officerForm">
        <label for="name">Имя:</label>
        <input type="text" id="name" name="name" required>
        <label for="rank">Звание:</label>
        <input type="text" id="rank" name="rank" required>
        <label for="date_of_commission">Дата присвоения звания:</label>
        <input type="date" id="date_of_commission" name="date_of_commission" required>
        <button type="submit">Добавить офицера</button>
    </form>
    <table id="officersTable">
        <tr>
            <th>ID</th>
            <th>Имя</th>
            <th>Звание</th>
            <th>Дата присвоения звания</th>
            <th>Действия</th>
        </tr>
    </table>

    <h2>Части</h2>
    <form id="partForm">
        <label for="partName">Название:</label>
        <input type="text" id="partName" name="partName" required>
        <label for="location">Местоположение:</label>
        <input type="text" id="location" name="location" required>
        <label for="commanderId">ID командира:</label>
        <input type="number" id="commanderId" name="commanderId" required>
        <button type="submit">Добавить часть</button>
    </form>
    <table id="partsTable">
        <tr>
            <th>ID</th>
            <th>Название</th>
            <th>Местоположение</th>
            <th>ID командира</th>
            <th>Действия</th>
        </tr>
    </table>

    <script>
        function fetchOfficers() {
            fetch("/officers")
            .then(response => response.json())
            .then(data => {
                const table = document.getElementById("officersTable");
                table.innerHTML = "<tr><th>ID</th><th>Имя</th><th>Звание</th><th>Дата присвоения звания</th><th>Действия</th></tr>";
                data.forEach(officer => {
                    const row = `<tr>
                        <td>${officer[0]}</td>
                        <td>${officer[1]}</td>
                        <td>${officer[2]}</td>
                        <td>${officer[3]}</td>
                        <td><button onclick="deleteOfficer(${officer[0]})">Удалить</button></td>
                    </tr>`;
                    table.insertAdjacentHTML("beforeend", row);
                });
            });
        }

        function fetchParts() {
            fetch("/parts")
            .then(response => response.json())
            .then(data => {
                const table = document.getElementById("partsTable");
                table.innerHTML = "<tr><th>ID</th><th>Название</th><th>Местоположение</th><th>ID командира</th><th>Действия</th></tr>";
                data.forEach(part => {
                    const row = `<tr>
                        <td>${part[0]}</td>
                        <td>${part[1]}</td>
                        <td>${part[2]}</td>
                        <td>${part[3]}</td>
                        <td><button onclick="deletePart(${part[0]})">Удалить</button></td>
                    </tr>`;
                    table.insertAdjacentHTML("beforeend", row);
                });
            });
        }

        function deleteOfficer(id) {
            fetch(`/officers/${id}`, {
                method: "DELETE"
            })
            .then(response => response.json())
            .then(data => {
                alert(data.message);
                fetchOfficers();
            });
        }

        function deletePart(id) {
            fetch(`/parts/${id}`, {
                method: "DELETE"
            })
            .then(response => response.json())
            .then(data => {
                alert(data.message);
                fetchParts();
            });
        }

        document.getElementById("officerForm").addEventListener("submit", function(event) {
            event.preventDefault();
            const formData = new FormData(this);
            fetch("/officers", {
                method: "POST",
                body: JSON.stringify(Object.fromEntries(formData)),
                headers: {
                    "Content-Type": "application/json"
                }
            })
            .then(response => response.json())
            .then(data => {
                alert(data.message);
                fetchOfficers();
            })
            .catch(error => console.error("Ошибка:", error));
        });

        document.getElementById("partForm").addEventListener("submit", function(event) {
            event.preventDefault();
            const formData = new FormData(this);
            fetch("/parts", {
                method: "POST",
                body: JSON.stringify(Object.fromEntries(formData)),
                headers: {
                    "Content-Type": "application/json"
                }
            })
            .then(response => response.json())
            .then(data => {
                alert(data.message);
                fetchParts();
            })
            .catch(error => console.error("Ошибка:", error));
        });

        // Загрузка данных об офицерах и частях при загрузке страницы
        fetchOfficers();
        fetchParts();
    </script>
</body>
</html>
